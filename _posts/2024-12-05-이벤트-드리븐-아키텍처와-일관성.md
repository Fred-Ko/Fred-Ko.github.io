---
noteID: d5982080-70cf-432c-84c5-a525848fc054
---
## 이벤트 드리븐 아키텍처

- 마이크로서비스의 독립성과 확장성을 제공함
- 비동기적 통신과 느슨한 결합을 특징으로 함
- 일관성(consistency) 유지를 어렵게 만듦

## 일관성 모델 종류

- **강력한 일관성**: 모든 시스템이 동일한 시점에 데이터 일관성을 유지함. 구현이 어렵고 성능 저하가 발생할 수 있음.
- **약한 일관성**: 데이터 일관성이 항상 보장되지 않음. 처리 성능이 높지만 데이터 불일치가 발생할 가능성이 있음.
- **최종적 일관성**: 시간이 지나면서 일관된 상태에 도달함. 시스템 확장성에 유리하나 즉시 일관성을 보장하지 않음.

| 일관성 모델  | 구현 난이도 | 장점                               | 단점               |
| ------- | ------ | -------------------------------- | ---------------- |
| 강력한 일관성 | 높음     | 데이터 정확성을 보장함                     | 성능 저하 및 높은 복잡도   |
| 약한 일관성  | 낮음     | 높은 처리 성능과 빠른 응답 시간을 제공함          | 데이터 불일치가 발생할 가능성 |
| 최종적 일관성 | 중간     | 시스템 확장성과 유연성을 제공하고 성능을 최적화할 수 있음 | 즉시 일관성을 보장하지 않음  |

## 일관성 모델과 예시

- **강력한 일관성 예시**

  - 은행 시스템의 계좌 이체는 강력한 일관성이 요구됨.
  - 고객의 A 계좌에서 B 계좌로 자금이 이동할 때, 모든 관련 데이터베이스는 동일한 시점에 변경되어야 함. 이를 통해 고객이 자신의 잔액을 잘못 확인하는 문제를 방지함.

- **약한 일관성 예시**

  - 소셜 미디어의 좋아요 수는 약한 일관성을 가질 수 있음.
  - 한 사용자가 게시물에 "좋아요"를 누르면 즉시 모든 사용자에게 일관된 상태로 반영되지 않을 수 있지만, 서비스 성능을 위해 데이터 불일치가 허용됨.

- **최종적 일관성 예시**

  - 온라인 쇼핑몰의 상품 재고 시스템은 최종적 일관성을 가짐.
  - 여러 사용자가 동시에 상품을 장바구니에 담을 때, 재고 수량은 시간이 지나면서 최종적으로 일관된 상태에 도달함. 일시적인 불일치가 발생할 수 있지만, 시간이 지나면 모든 데이터가 정확히 반영됨.

## 일관성 구현 방법

- **강력한 일관성**: 분산 락, Paxos, Raft와 같은 합의 알고리즘을 사용하거나, 2단계 커밋 프로토콜(2PC)을 통해 강력한 일관성을 유지함.
    
    1. **분산 락(Distributed Lock)**: 여러 노드가 동일한 자원을 동시에 수정하지 않도록 하기 위해 사용함. 이를 통해 충돌을 방지하고 데이터 일관성을 보장함. 예를 들어, Zookeeper와 같은 도구를 사용해 분산 락을 구현할 수 있음.
        
    2. **Paxos 및 Raft 합의 알고리즘**: 분산 시스템에서 노드들이 합의에 도달하게 하는 알고리즘으로, 데이터 변경에 대한 일관성을 보장함. **Paxos**는 구현이 복잡하지만 이론적으로 강력하고, **Raft**는 상대적으로 구현이 쉽고 널리 사용됨.
        
    3. **2단계 커밋 프로토콜(2PC)**: 트랜잭션을 준비 단계와 커밋 단계로 나누어 각 노드가 커밋 가능 여부를 응답하고, 모든 노드가 커밋 가능한 상태일 때 실제 변경을 진행함. 강력한 데이터 일관성을 제공하지만, 네트워크 지연이나 노드 장애 시 교착 상태와 성능 저하가 발생할 수 있음.
        
- **약한 일관성**: 캐시 및 복제본을 통한 데이터 읽기 최적화를 사용함.
    
    1. **캐시(Cache)**: 데이터베이스 부하를 줄이고 응답 시간을 개선하기 위해 캐시를 사용함. 빠른 읽기 성능을 제공하지만, 캐시와 원본 데이터 간의 불일치가 발생할 수 있음.
        
    2. **복제본에서 읽기(Read from Replicas)**: 여러 복제본을 생성하여 읽기 요청을 분산시킴. 이를 통해 확장성과 성능을 높일 수 있으나, 복제본 간 데이터 일관성이 보장되지 않을 수 있음.
        
    3. **데이터 유효성 검사**: 타임스탬프 등을 통해 최신 데이터를 확인하거나 특정 시점에 데이터를 재동기화하여 불일치를 최소화함.
        
- **최종적 일관성**: 메시지 브로커(Kafka, RabbitMQ 등)를 사용해 데이터 일관성을 보장함.
    
    1. **메시지 브로커**: **Kafka**, **RabbitMQ** 등을 사용해 이벤트 기반으로 데이터 일관성을 유지함. 각 서비스는 이벤트를 구독해 상태를 업데이트하며, 최종적으로 일관된 상태에 도달함.
        
    2. **지연 허용 시스템(Eventual Consistency Systems)**: 일시적인 불일치를 감수하고 각 서비스가 독립적으로 데이터를 처리한 후 최종적으로 동기화함. 성능과 확장성에 유리함.
        
    3. **상태 재조정(State Reconciliation)**: 비동기적으로 데이터를 동기화하여 일정 주기로 시스템 상태를 재조정함. 예를 들어, 재고 관리 시스템에서 일정 주기로 데이터 일관성을 맞춤.