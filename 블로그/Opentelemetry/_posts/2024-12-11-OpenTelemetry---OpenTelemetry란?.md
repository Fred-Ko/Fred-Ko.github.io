---
title: OpenTelemetry - OpenTelemetry란?
date: 2024-12-11
categories: []
tags: [opentelemetry, open-source, telemetry-data, metrics, logs, trace, microservices-architecture, event-driven-architecture, api, sdk]
---
## **OpenTelemetry란?**

OpenTelemetry는 벤더에 종속되지 않는 오픈 소스 관찰 가능성 프레임워크로, 애플리케이션의 성능과 동작을 분석하기 위해 텔레메트리 데이터(Metrics, Logs, Trace)를 계측, 생성, 수집 및 내보낼 수 있도록 지원합니다. 이를 통해 시스템 성능 최적화와 장애 대응 능력을 향상시킬 수 있으며, 다양한 프로그래밍 언어와 플랫폼을 지원하여 클라우드 네이티브 환경에서의 호환성을 제공합니다.

### **Metrics, Logs, Trace의 통합 필요성**

![](assets/img/pasted-image-20241212024442.webp)

분산 시스템에서 MSA(Microservices Architecture)와 EDA(Event-Driven Architecture)가 널리 채택되면서 서비스 간 상호작용과 복잡성이 기하급수적으로 증가하고 있습니다. 이러한 환경에서는 시스템의 상태를 종합적으로 이해하고 문제를 해결하는 데 더욱 어려움이 따릅니다. Metrics, Logs, Trace의 통합은 중요합니다.

#### **모놀리스 아키텍처**
- 단일 애플리케이션 내에서 모든 기능이 통합되어 실행
- 로깅과 모니터링이 비교적 단순
- 문제 발생 시 로그 파일만으로도 문제 추적 가능

#### **MSA + EDA 아키텍처**
- 여러 마이크로서비스가 분산되어 실행
- 서비스 간 비동기 이벤트 기반 통신
- 복잡한 서비스 의존성과 상호작용
- 단일 요청이 여러 서비스를 경유

##### **분산 Trace의 필요성**

1. **End to End 가시성**
   - 요청의 전체 여정 추적
   - 서비스 간 지연 시간 식별
   - 병목 구간 파악

2. **문제 해결 효율성**
   - 장애 발생 지점 신속 파악
   - 서비스 간 의존성 시각화
   - 성능 최적화 지점 식별

##### **통합 모니터링의 중요성**

1. **상호 연계된 분석**
   - Trace로 식별된 문제 구간의 상세 로그 확인
   - 성능 지표(Metrics)와 Trace 정보의 연계
   - 시스템 전반의 건강 상태 통합 모니터링

2. **효율적인 운영**
   - 단일 플랫폼에서 모든 텔레메트리 데이터 관리
   - 신속한 문제 해결과 의사결정
   - 예방적 모니터링 가능

---

## **핵심 개념**

### **Trace**
  
**Trace**는 분산 시스템에서 요청이 처리되는 전체 경로를 추적하는 데 사용되는 텔레메트리 데이터의 한 유형입니다.

- **정의**: Trace는 하나의 요청이 시스템을 통해 이동하는 **전체 과정**을 나타내며, 여러 개의 Span으로 구성됩니다. 각 Span은 특정 작업이나 프로세스를 나타내며, 이러한 Span들이 함께 모여 전체 요청의 경로를 형성합니다.
- **예시**: 사용자가 웹 애플리케이션에서 특정 기능을 호출할 때, 이 요청은 여러 마이크로서비스를 거치게 됩니다. Trace는 이 요청이 각 서비스를 통해 이동하는 경로를 기록하여, 전체 요청의 처리 시간, 병목 구간, 그리고 각 서비스 간의 상호작용을 시각화할 수 있도록 합니다.

### **Span**

**Span**은 Trace의 구성 요소로, 특정 작업이나 프로세스를 나타내는 단위입니다.

- **정의**: Span은 Trace 내에서 발생하는 개별 작업을 나타내며, 시작과 끝 시간, 이름, 속성, 이벤트 등으로 구성됩니다. Span은 **Trace의 일부**로, Trace가 여러 Span으로 구성될 수 있습니다.
- **예시**: 사용자가 데이터베이스 쿼리를 실행할 때, 이 쿼리 실행은 하나의 Span으로 나타낼 수 있습니다. 이 Span은 쿼리 실행의 시작과 끝 시간, 쿼리 문, 그리고 추가적인 속성들을 포함할 수 있습니다.

### **Metrics**

**Metrics**은 시스템의 성능이나 상태를 수치적으로 나타내는 텔레메트리 데이터의 한 유형입니다.

- **정의**: Metrics는 시스템의 특정 지표를 측정하여 수치로 표현합니다. 예로는 CPU 사용률, 메모리 사용량, 요청 처리 시간 등이 있습니다. Metrics는 시간에 따라 변하는 값을 기록하여 시스템의 성능을 모니터링하고, 문제를 예측 및 해결하는 데 사용됩니다.
- **예시**: 애플리케이션의 응답 시간, 요청 처리량, 에러율 등이 Metrics의 예입니다. 이러한 Metrics들은 Prometheus나 Grafana와 같은 도구를 통해 시각화되어 시스템의 상태를 실시간으로 모니터링할 수 있습니다.

### **Logs**

**Logs**는 시스템에서 발생하는 이벤트나 작업을 기록하는 텔레메트리 데이터의 한 유형입니다.

- **정의**: Logs는 시스템에서 발생하는 각 이벤트나 작업을 시간순으로 기록합니다. Logs는 디버깅, 문제 해결, 그리고 시스템의 동작을 이해하는 데 중요한 역할을 합니다. Logs는 일반적으로 텍스트 형식으로 저장되며, 각 로그 엔트리는 타임스탬프, 로그 레벨, 메시지 등으로 구성됩니다.
- **예시**: 애플리케이션에서 발생하는 오류, 사용자 로그인 이벤트, 데이터베이스 쿼리 실행 등이 Logs의 예입니다. 이러한 Logs는 Elasticsearch나 Splunk와 같은 로그 관리 도구를 통해 집중적으로 관리되고 분석될 수 있습니다.

---

## **API와 SDK의 역할**

- **API**: OpenTelemetry는 표준화된 API를 통해 개발자가 손쉽게 텔레메트리 데이터를 애플리케이션 코드에서 수집할 수 있도록 지원합니다.
- **SDK**: SDK는 API의 구현체로, 다양한 언어를 지원하며 데이터 수집, 처리, 내보내기(export) 기능을 제공합니다. 이를 통해 데이터가 OpenTelemetry의 Collector나 백엔드 시스템으로 전달됩니다.

---

## **Collector 개요**

Collector는 OpenTelemetry 생태계의 중심적인 컴포넌트로, 데이터를 수집하고 변환하며, 필요한 경우 이를 적절한 외부 시스템으로 내보냅니다. Collector는 다양한 소스 및 백엔드와의 호환성을 제공하며, 텔레메트리 데이터의 전처리 작업을 효과적으로 수행합니다.

---

## **Exporters의 기능**

Exporters는 수집된 텔레메트리 데이터를 외부 백엔드(Jaeger, Prometheus, Elasticsearch 등)로 전송하는 모듈입니다. 각 Exporter는 특정 백엔드와의 통합을 간소화하여 운영자가 데이터를 손쉽게 시각화하고 분석할 수 있도록 돕습니다.

---

## **OTLP(OpenTelemetry Protocol)**

OTLP는 OpenTelemetry가 사용하는 효율적인 데이터 전송 프로토콜로, Logs, Metrics, Trace 데이터를 통합적으로 관리하며 고성능 전송을 보장합니다. OTLP는 확장성과 호환성을 모두 고려하여 설계되었으며, 다양한 클라우드 기반 및 온프레미스 환경에서 활용할 수 있습니다.

---

## **정리**

### **왜 필요한가요?**

#### **MSA 환경의 복잡성**
- 모놀리스 아키텍처와 달리, MSA 환경에서는 여러 마이크로서비스가 동기적 및 비동기적 통신을 통해 하나의 요청을 처리합니다.
- 이로 인해 요청이 처리되는 경로가 복잡해지며, 에러가 발생한 구간을 파악하기 어려워집니다.

#### **분산 Trace의 필요성**
- 분산 Trace는 요청의 전체 경로를 시각적으로 표현하여, 각 서비스 간의 통신 정보를 종합적으로 보여줍니다.
- 이는 에러가 발생한 구간을 빠르게 식별하고, 문제를 해결하는 데 도움이 됩니다.

### **무엇을 제공해주나요?**

#### **요청 관점의 FLOW 시각화**
- OpenTelemetry는 요청이 처리되는 전체 경로를 시각적으로 제공하여, 각 서비스의 통신 정보를 하나의 흐름으로 표현합니다.

#### **서비스 간 통신 정보 통합**
- Trace, Logs, Metrics 데이터를 통합하여, 특정 시점에서 어떤 상황이었는지 정보를 제공합니다.
- 이는 각 서비스의 상태와 성능을 종합적으로 이해하는 데 도움이 됩니다.

#### **상호 연계된 분석**
- Trace와 Logs, Metrics 데이터 간의 상호 연계를 지원하여, 문제 구간의 상세 로그 확인, 성능 지표와 Trace 정보의 연계, 시스템 전반의 건강 상태 통합 모니터링이 가능합니다.

### **무엇을 얻을 수 있나요?**

#### **빠른 장애 파악과 대응**
- 복잡한 시스템에서 에러가 발생한 구간을 빠르게 식별하고 대응할 수 있어, 비용을 절감할 수 있습니다.

#### **조기 대응**
- 문제가 발생하기 전에 예방적 모니터링을 통해 조기 대응이 가능해, 비용을 절감할 수 있습니다.

#### **성능 최적화**
- 시스템의 성능을 실시간으로 모니터링하여, 성능 최적화 지점을 식별하고 개선할 수 있어, 비용을 절감할 수 있습니다.
